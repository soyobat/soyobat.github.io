<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.soyorin.online","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":10,"width":280,"onmobile":true},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac","show_result":true},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":"night eighties"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
<meta property="og:url" content="https://www.soyorin.online/page/17/index.html">
<meta property="og:site_name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lkl">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="å­¦ä¹ ">
<meta property="article:tag" content="åšå®¢">
<meta property="article:tag" content="æ—¥å¸¸">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.soyorin.online/page/17/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/17/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Îµ=(Â´Î¿ï½€*)))å”‰ï¼Œå­¦Javaçš„è¿™è¾ˆå­æœ‰äº†</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-å‹é“¾"><a href="/link/" rel="section"><i class="fas fa-link fa-fw"></i>å‹é“¾</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lkl"
      src="/images/boqi.jpg">
  <p class="site-author-name" itemprop="name">lkl</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">441</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/soyobat" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;soyobat" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/13/%E5%BC%80%E6%BA%90%E7%9B%B8%E5%85%B3/%E7%BB%99github%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%8F%90pr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/13/%E5%BC%80%E6%BA%90%E7%9B%B8%E5%85%B3/%E7%BB%99github%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%8F%90pr/" class="post-title-link" itemprop="url">ç»™githubå¼€æºé¡¹ç›®æpr</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-13 21:10:13 / ä¿®æ”¹æ—¶é—´ï¼š21:18:48" itemprop="dateCreated datePublished" datetime="2025-08-13T21:10:13+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E6%BA%90%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">å¼€æºç›¸å…³</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ç»™å¼€æºé¡¹ç›®æ PR ä¿® bug çš„æµç¨‹ï¼Œå…¶å®å°±åƒâ€œæ¬è¿›åˆ«äººå®¶çš„æˆ¿å­å¸®å¿™ä¿®æ°´ç®¡â€ï¼Œæ—¢è¦ä¿®å¥½ï¼Œè¿˜å¾—ç¬¦åˆäººå®¶çš„è§„çŸ©ã€‚<br>æˆ‘ç»™ä½ åˆ†æˆ <strong>å‘ç°é—®é¢˜ â†’ ä¿®å¤ä»£ç  â†’ æäº¤ PR â†’ è·Ÿè¿›</strong> å››ä¸ªé˜¶æ®µï¼Œé¡ºä¾¿è¡¥ä¸Šæ³¨æ„äº‹é¡¹ã€‚</p>
<hr>
<h2 id="1ï¸âƒ£-å‘ç°é—®é¢˜"><a href="#1ï¸âƒ£-å‘ç°é—®é¢˜" class="headerlink" title="1ï¸âƒ£ å‘ç°é—®é¢˜"></a>1ï¸âƒ£ å‘ç°é—®é¢˜</h2><ul>
<li><strong>ç¡®è®¤æ˜¯ bug</strong>ï¼šå…ˆçœ‹çœ‹æ˜¯ä¸æ˜¯è‡ªå·±ç¯å¢ƒé—®é¢˜ã€ä¾èµ–ç‰ˆæœ¬é—®é¢˜ã€‚</li>
<li><strong>æœç´¢ issue</strong>ï¼šåœ¨é¡¹ç›®çš„ Issues é‡ŒæŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰äººæè¿‡åŒæ ·é—®é¢˜ã€‚<ul>
<li>æœ‰ï¼šå¯ä»¥åœ¨å·²æœ‰ issue ä¸‹ç•™è¨€ï¼Œè¡¨æ˜ä½ ä¹Ÿé‡åˆ°ï¼Œå¹¶ä¸”æ„¿æ„ä¿®ã€‚</li>
<li>æ²¡æœ‰ï¼šæ–°å»ºä¸€ä¸ª issueï¼Œç®€æ˜æè¿°é—®é¢˜ã€å¤ç°æ­¥éª¤ã€æœŸæœ›ç»“æœã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="2ï¸âƒ£-ä¿®å¤ä»£ç "><a href="#2ï¸âƒ£-ä¿®å¤ä»£ç " class="headerlink" title="2ï¸âƒ£ ä¿®å¤ä»£ç "></a>2ï¸âƒ£ ä¿®å¤ä»£ç </h2><ol>
<li><strong>Fork é¡¹ç›®</strong><ul>
<li>åœ¨ GitHub&#x2F;GitLab ç‚¹å‡» <code>Fork</code>ï¼ŒæŠŠä»“åº“å¤åˆ¶åˆ°ä½ è‡ªå·±çš„è´¦å·ä¸‹ã€‚</li>
</ul>
</li>
<li><strong>Clone åˆ°æœ¬åœ°</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¤åˆ¶ç¼–è¾‘</span><br><span class="line">git clone https://github.com/ä½ çš„è´¦å·/é¡¹ç›®å.git</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>åˆ›å»ºåˆ†æ”¯</strong>ï¼ˆä¸è¦åœ¨ <code>main/master</code> ä¸Šç›´æ¥æ”¹ï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¤åˆ¶ç¼–è¾‘</span><br><span class="line">git checkout -b fix/xxx-bug</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>æœ¬åœ°è¿è¡Œå¹¶å¤ç° bug</strong>ï¼ˆç¡®ä¿èƒ½ç¨³å®šå¤ç°ï¼Œä¿®çš„æ—¶å€™æ‰èƒ½éªŒè¯æˆåŠŸï¼‰ã€‚</li>
<li><strong>ä¿®æ”¹ä»£ç </strong>ï¼ˆéµå¾ªé¡¹ç›®çš„ä»£ç è§„èŒƒï¼Œæ¯”å¦‚ç¼©è¿›ã€å‘½åã€æ³¨é‡Šæ ¼å¼ï¼‰ã€‚</li>
<li><strong>å†™å•å…ƒæµ‹è¯•</strong>ï¼ˆèƒ½é˜²æ­¢ bug å†æ¬¡å‡ºç°ï¼Œç»´æŠ¤è€…ä¼šå¾ˆå–œæ¬¢ï¼‰ã€‚</li>
<li><strong>æœ¬åœ°è·‘æµ‹è¯•</strong>ï¼ˆ<code>mvn test</code> &#x2F; <code>npm test</code> &#x2F; <code>pytest</code> ç­‰ï¼Œçœ‹é¡¹ç›®ç”¨ä»€ä¹ˆå·¥å…·ï¼‰ã€‚</li>
</ol>
<hr>
<h2 id="3ï¸âƒ£-æäº¤-PR"><a href="#3ï¸âƒ£-æäº¤-PR" class="headerlink" title="3ï¸âƒ£ æäº¤ PR"></a>3ï¸âƒ£ æäº¤ PR</h2><ol>
<li><strong>æäº¤ä¿®æ”¹</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¤åˆ¶ç¼–è¾‘</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;fix: ä¿®å¤ xxx å¯¼è‡´çš„ xxx é—®é¢˜&quot;</span><br><span class="line">git push origin fix/xxx-bug</span><br></pre></td></tr></table></figure>

<pre><code>- commit ä¿¡æ¯ä¸€èˆ¬ç”¨è‹±æ–‡æè¿°ï¼Œéµå¾ªé¡¹ç›® commit è§„èŒƒï¼ˆå¦‚ Conventional Commitsï¼‰ã€‚
</code></pre>
<ol start="2">
<li><strong>åœ¨ GitHub å‘èµ· Pull Request</strong><ul>
<li>é€‰æ‹©ç›®æ ‡ä»“åº“çš„ä¸»åˆ†æ”¯ä½œä¸º <code>base</code>ï¼Œä½ çš„åˆ†æ”¯ä½œä¸º <code>compare</code>ã€‚</li>
<li>åœ¨ PR æè¿°é‡Œå†™æ¸…ï¼š<ul>
<li>é—®é¢˜èƒŒæ™¯</li>
<li>ä¿®å¤æ€è·¯</li>
<li>æµ‹è¯•ç»“æœæˆªå›¾ï¼ˆå¯é€‰ï¼‰</li>
<li>å…³è”çš„ issueï¼ˆæ¯”å¦‚ <code>Closes #123</code> ä¼šè‡ªåŠ¨å…³é—­ issueï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><strong>æ³¨æ„ CI æ£€æŸ¥</strong>ï¼šå¾ˆå¤šé¡¹ç›®ä¼šè‡ªåŠ¨è·‘ä»£ç æ£€æŸ¥ã€æµ‹è¯•ç”¨ä¾‹ï¼Œä¸é€šè¿‡çš„è¯ä½ éœ€è¦å†æ”¹ã€‚</li>
</ol>
<hr>
<h2 id="4ï¸âƒ£-è·Ÿè¿›ä¸ç»´æŠ¤"><a href="#4ï¸âƒ£-è·Ÿè¿›ä¸ç»´æŠ¤" class="headerlink" title="4ï¸âƒ£ è·Ÿè¿›ä¸ç»´æŠ¤"></a>4ï¸âƒ£ è·Ÿè¿›ä¸ç»´æŠ¤</h2><ul>
<li><strong>ç»´æŠ¤è€…å¯èƒ½ä¼š review</strong>ï¼šä»–ä»¬å¯èƒ½ä¼šæä¿®æ”¹å»ºè®®ï¼Œä½ è¦åŠæ—¶å›å¤å¹¶ä¿®æ”¹ä»£ç ã€‚</li>
<li><strong>PR åˆå¹¶å</strong>ï¼šå¯ä»¥åœ¨åç»­ release ä¸­çœ‹åˆ°è‡ªå·±çš„è´¡çŒ®ã€‚</li>
<li><strong>å…»æˆä¹ æƒ¯</strong>ï¼šåœ¨ä½  fork çš„é¡¹ç›®é‡Œå®šæœŸ <code>git fetch upstream</code> åŒæ­¥æºä»“åº“ä»£ç ã€‚</li>
</ul>
<hr>
<p>ğŸ’¡ <strong>å°æŠ€å·§</strong></p>
<ul>
<li>åˆ«æ€¥ç€ç›´æ¥ä¿®ï¼Œå…ˆçœ‹çœ‹é¡¹ç›®çš„ <code>CONTRIBUTING.md</code>ï¼ˆè´¡çŒ®æŒ‡å—ï¼‰å’Œ <code>CODE_OF_CONDUCT.md</code>ï¼ˆè¡Œä¸ºè§„èŒƒï¼‰ã€‚</li>
<li>å¦‚æœ bug æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥å…ˆå‘ issue è®©ç»´æŠ¤è€…ç¡®è®¤ï¼Œé¿å…ç™½åšã€‚</li>
<li>å…ˆä¿®å° bugã€æ–‡æ¡£é”™åˆ«å­—ï¼Œç†Ÿæ‚‰æµç¨‹åå†åšå¤§åŠŸèƒ½ï¼Œå®¹æ˜“å»ºç«‹ä¿¡ä»»ã€‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/13/caffeine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/13/caffeine/" class="post-title-link" itemprop="url">caffeine</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-13 21:06:48" itemprop="dateCreated datePublished" datetime="2025-08-13T21:06:48+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-18 02:24:04" itemprop="dateModified" datetime="2025-10-18T02:24:04+08:00">2025-10-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Cache&lt;String, Integer&gt; cache =</span><br><span class="line">                Caffeine.newBuilder()</span><br><span class="line">                        .maximumSize(<span class="number">1000</span>)</span><br><span class="line">                        .recordStats()</span><br><span class="line"><span class="comment">//                        .expireAfterWrite(5, TimeUnit.SECONDS)</span></span><br><span class="line"><span class="comment">//                        .expireAfterAccess(2, TimeUnit.SECONDS)</span></span><br><span class="line">                        .expireAfter(<span class="keyword">new</span> <span class="title class_">Expiry</span>&lt;String, Integer&gt;() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">expireAfterCreate</span><span class="params">(<span class="meta">@NonNull</span> String key, <span class="meta">@NonNull</span> Integer value, <span class="type">long</span> currentTime)</span> &#123;</span><br><span class="line">                                <span class="keyword">return</span> currentTime;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">expireAfterUpdate</span><span class="params">(<span class="meta">@NonNull</span> String key, <span class="meta">@NonNull</span> Integer value, <span class="type">long</span> currentTime, <span class="meta">@NonNegative</span> <span class="type">long</span> currentDuration)</span> &#123;</span><br><span class="line">                                <span class="keyword">return</span> currentDuration;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">expireAfterRead</span><span class="params">(<span class="meta">@NonNull</span> String key, <span class="meta">@NonNull</span> Integer value, <span class="type">long</span> currentTime, <span class="meta">@NonNegative</span> <span class="type">long</span> currentDuration)</span> &#123;</span><br><span class="line">                                <span class="keyword">return</span> currentDuration;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .removalListener(<span class="keyword">new</span> <span class="title class_">RemovalListener</span>&lt;String, Integer&gt;() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRemoval</span><span class="params">(<span class="meta">@Nullable</span> String key, <span class="meta">@Nullable</span> Integer value, <span class="meta">@NonNull</span> RemovalCause cause)</span> &#123;</span><br><span class="line"></span><br><span class="line">                                System.out.println(<span class="string">&quot;ç§»é™¤äº†keyï¼š&quot;</span> + key + <span class="string">&quot; value :&quot;</span> + value + <span class="string">&quot; cause : &quot;</span> + cause);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .build();</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;cliffcw1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(cache.getIfPresent(<span class="string">&quot;cliffcw1&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯å˜è¿‡æœŸæ—¶é—´ç­–ç•¥æœ‰æ²¡æœ‰æä¾›ï¼Œå¦‚æœæœ‰ï¼Œå°±putï¼Œ</span></span><br><span class="line">        cache.policy().expireVariably().ifPresent(policy -&gt; &#123;</span><br><span class="line">            policy.put(<span class="string">&quot;cliffcw2&quot;</span>, <span class="number">2</span>, <span class="number">13</span>, TimeUnit.SECONDS);</span><br><span class="line">            policy.put(<span class="string">&quot;cliffcw3&quot;</span>, <span class="number">2</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;cliffcw2:&quot;</span> + cache.getIfPresent(<span class="string">&quot;cliffcw2&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">11000</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;cliffcw22:&quot;</span> + cache.getIfPresent(<span class="string">&quot;cliffcw2&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;cliffcw3:&quot;</span> + cache.getIfPresent(<span class="string">&quot;cliffcw3&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//åˆ é™¤æ˜¯æƒ°æ€§åˆ é™¤</span></span><br></pre></td></tr></table></figure>



<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>ç”¨æœ¬åœ°éœ€è¦è€ƒè™‘çš„ç‚¹</p>
<ol>
<li>åŠŸèƒ½èƒ½æ»¡è¶³ï¼Œgetï¼Œputï¼Œè¿‡æœŸ</li>
<li>ä¸èƒ½OOMï¼Œå†…å­˜ç®¡ç†</li>
<li>ç›‘æ§å±•ç¤ºï¼ˆè‚¯å®šä¸èƒ½æ˜¯é»‘ç›’ï¼Œæ— æç¤ºæ€§è¯­å¥ï¼‰</li>
<li>ç»Ÿè®¡ï¼ˆçƒ­keyï¼Œå¤§keyï¼Œå‘½ä¸­ç‡ â€¦.ï¼‰</li>
</ol>
<p>caffeineçš„ç¼ºç‚¹</p>
<ol>
<li>åŠŸèƒ½åŸºæœ¬æ»¡è¶³ï¼Œä½†å¤šä¸ªä¸šåŠ¡åœºæ™¯ï¼Œå¤šç§è¿‡æœŸæ—¶é—´ï¼Œä¸æ»¡è¶³</li>
<li>åªæœ‰keyä¸ªæ•°ä¸Šé™ï¼ˆä¸è®¾ç½®é»˜è®¤æ˜¯ï¼‰æ— æ³•è®¾ç½®ä½¿ç”¨å†…å­˜ä¸Šé™</li>
</ol>
<p>è§£å†³ï¼š</p>
<ol>
<li>ç»™ä¸åŒkvè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´</li>
</ol>
<p>:::info<br>å…¶å®æ˜¯æœ‰çš„ï¼Œåªæ˜¯éšè—å¾—æ¯”è¾ƒæ·±</p>
<p>&#x2F;&#x2F; å¯å˜è¿‡æœŸæ—¶é—´ç­–ç•¥æ²¡æœ‰æä¾›ï¼Œå¦‚æœæœ‰ï¼Œé‚£å°±putã€‚å¦‚æœä¸å¯å˜é‚£ä»€ä¹ˆéƒ½æ²¡æœ‰</p>
<p>cache.policy().expireVariably().ifPresent( policy -&gt; { policy.put( xx,xx,xx,xx ) })</p>
<p>:::</p>
<ol start="2">
<li>å¯ä»¥ç»™å†…å­˜è®¾ç½®ä¸Šé™</li>
</ol>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><h3 id="build"><a href="#build" class="headerlink" title="build()"></a>build()</h3><p>BoundedLocalManualCache å’Œ NoBoundedLocalManualCache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BoundedLocalManualCache(Caffeine&lt;K, V&gt; builder, <span class="meta">@Nullable</span> CacheLoader&lt;? <span class="built_in">super</span> K, V&gt; loader) &#123;</span><br><span class="line">    cache = LocalCacheFactory.newBoundedLocalCache(builder, loader, <span class="comment">/* async */</span> <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> BoundedLocalCache&lt;K, V&gt; <span class="title function_">cache</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line"></span><br><span class="line">BoundedLocalCache -&gt; LocalCache -&gt; ConcurrentHashMap</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LocalCacheFactory</span>:</span><br><span class="line"><span class="comment">//é’ˆå¯¹æ¯ç§é…ç½®ï¼Œcaffeineä¼šç”Ÿæˆæ¯ç§é…ç½®ç±»ï¼Œä½†å®ƒä»¬éƒ½ç»§æ‰¿äºLocalCacheï¼Œè¿™æ ·çš„è¯å°±ä¸ç”¨åœ¨ä»£ç ä¸­è¿›è¡Œifåˆ¤æ–­ï¼Œå› ä¸ºifåˆ¤æ–­å“ªåœ¨cpuåº•å±‚ä¹Ÿæ˜¯éœ€è¦è€—æ—¶çš„ï¼Œæ‰€ä»¥è¯´ä¼˜åŒ–åˆ°æè‡´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ˜¯æ ¹æ®é…ç½®ç”Ÿæˆå¯¹åº”é…ç½®ç±»çš„ç±»åï¼Œç„¶åæ ¹æ®è¿™ä¸ªç±»åå»æ‰¾åˆ°å¯¹åº”çš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment">//æ€æƒ³ï¼šå°±æ˜¯ç”¨å…ƒæ•°æ®ç©ºé—´æ¢ ifåˆ†æ”¯åˆ¤æ–­æ—¶é—´</span></span><br><span class="line"><span class="comment">//æƒ³è±¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åº”ç”¨åœºæ™¯ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">getClassName</span><span class="params">(Caffeine&lt;?, ?&gt; builder)</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">className</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(LocalCacheFactory.class.getPackageName()).append(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (builder.isStrongKeys()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;S&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;W&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.isStrongValues()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;S&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;I&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.removalListener != <span class="literal">null</span>) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;L&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.isRecordingStats()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;S&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.evicts()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;M&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (builder.isWeighted()) &#123;</span><br><span class="line">            className.append(<span class="string">&#x27;W&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            className.append(<span class="string">&#x27;S&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.expiresAfterAccess() || builder.expiresVariable()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.expiresAfterWrite()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;W&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (builder.refreshAfterWrite()) &#123;</span><br><span class="line">        className.append(<span class="string">&#x27;R&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> className.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="put"><a href="#put" class="headerlink" title="put"></a>put</h3><p>åº•å±‚å…¶å®å°±æ˜¯ä¸€ä¸ªdata:ConcurrentHashMap</p>
<p>put -&gt; data -&gt; writeBuffer.offer(å…¨å±€æœ‰ç•Œé˜Ÿåˆ—)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ä½œç”¨ï¼šå°†é”®å€¼å¯¹æ”¾å…¥ç¼“å­˜ï¼Œå¦‚æœé”®å·²å­˜åœ¨åˆ™è¦†ç›–æ—§å€¼ï¼ˆé™¤éonlyIfAbsentä¸ºtrueï¼‰</span></span><br><span class="line"><span class="comment">// å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">//   key: ç¼“å­˜é”®</span></span><br><span class="line"><span class="comment">//   value: ç¼“å­˜å€¼</span></span><br><span class="line"><span class="comment">//   expiry: è¿‡æœŸç­–ç•¥ï¼Œç”¨äºè®¡ç®—æ¡ç›®çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">//   onlyIfAbsent: å¦‚æœä¸ºtrueï¼Œåˆ™ä»…å½“é”®ä¸å­˜åœ¨æ—¶æ‰æ”¾å…¥ï¼ˆç±»ä¼¼putIfAbsentï¼‰</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šå¦‚æœé”®å·²å­˜åœ¨ä¸”è¢«è¦†ç›–ï¼Œåˆ™è¿”å›æ—§å€¼ï¼›å¦åˆ™è¿”å›null</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">V <span class="title function_">put</span><span class="params">(K key, V value, Expiry&lt;K, V&gt; expiry, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">    <span class="comment">// å‚æ•°æ ¡éªŒï¼šç¡®ä¿é”®å’Œå€¼ä¸ä¸ºç©º</span></span><br><span class="line">    requireNonNull(key);</span><br><span class="line">    requireNonNull(value);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–èŠ‚ç‚¹å˜é‡ï¼Œç”¨äºåœ¨é”®ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">    Node&lt;K, V&gt; node = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰æ—¶é—´ï¼ˆç”¨äºè¿‡æœŸæ—¶é—´è®¡ç®—ï¼‰</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> expirationTicker().read();</span><br><span class="line">    <span class="comment">// è®¡ç®—æ–°å€¼çš„æƒé‡ï¼ˆç”¨äºåŸºäºæƒé‡çš„å®¹é‡æ§åˆ¶ï¼‰</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newWeight</span> <span class="operator">=</span> weigher.weigh(key, value);</span><br><span class="line">    <span class="comment">// åˆ›å»ºç”¨äºæŸ¥æ‰¾çš„é”®å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯å¼±å¼•ç”¨æˆ–å¼ºå¼•ç”¨ï¼Œæ ¹æ®é…ç½®ï¼‰</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">lookupKey</span> <span class="operator">=</span> nodeFactory.newLookupKey(key);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡è‡ªæ—‹å¾ªç¯å¤„ç†å¹¶å‘æƒ…å†µï¼Œattemptsä¸ºé‡è¯•æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempts</span> <span class="operator">=</span> <span class="number">1</span>; ; attempts++) &#123;</span><br><span class="line">        <span class="comment">// ä»åº•å±‚ConcurrentHashMapä¸­è·å–å·²å­˜åœ¨çš„èŠ‚ç‚¹</span></span><br><span class="line">        Node&lt;K, V&gt; prior = data.get(lookupKey);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ========== åœºæ™¯1ï¼šé”®ä¸å­˜åœ¨ï¼ˆæ–°å¢ç¼“å­˜æ¡ç›®ï¼‰ ==========</span></span><br><span class="line">        <span class="keyword">if</span> (prior == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå°šæœªåˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œåˆ™åˆ›å»ºå®ƒ</span></span><br><span class="line">            <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ŒåŒ…å«é”®ã€å€¼ã€æƒé‡å’Œåˆ›å»ºæ—¶é—´</span></span><br><span class="line">                node = nodeFactory.newNode(key, keyReferenceQueue(), value, valueReferenceQueue(), newWeight, now);</span><br><span class="line">                <span class="comment">// è®¾ç½®èŠ‚ç‚¹çš„å¯å˜è¿‡æœŸæ—¶é—´ï¼ˆåŸºäºåˆ›å»ºæ—¶é—´è®¡ç®—ï¼‰</span></span><br><span class="line">                setVariableTime(node, expireAfterCreate(key, value, expiry, now));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å°è¯•å°†æ–°èŠ‚ç‚¹åŸå­æ€§åœ°æ”¾å…¥ç¼“å­˜Map</span></span><br><span class="line">            prior = data.putIfAbsent(node.getKeyReference(), node);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœæˆåŠŸæ”¾å…¥ï¼ˆpriorä¸ºnullè¡¨ç¤ºæ²¡æœ‰å…¶ä»–çº¿ç¨‹æŠ¢å…ˆæ”¾å…¥ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (prior == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œå†™åæ“ä½œï¼šå°†æ·»åŠ ä»»åŠ¡æäº¤åˆ°å†™ç¼“å†²åŒºï¼Œå¼‚æ­¥å¤„ç†ç¼“å­˜ç»´æŠ¤</span></span><br><span class="line">                afterWrite(<span class="keyword">new</span> <span class="title class_">AddTask</span>(node, newWeight));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// æ–°å¢æ¡ç›®ï¼Œè¿”å›null</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (onlyIfAbsent) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå…¶ä»–çº¿ç¨‹æŠ¢å…ˆæ”¾å…¥äº†è¯¥é”®ï¼Œä¸”onlyIfAbsentä¸ºtrueï¼Œåˆ™å°è¯•å¿«é€Ÿè¿”å›ç°æœ‰å€¼</span></span><br><span class="line">                <span class="type">V</span> <span class="variable">currentValue</span> <span class="operator">=</span> prior.getValue();</span><br><span class="line">                <span class="keyword">if</span> ((currentValue != <span class="literal">null</span>) &amp;&amp; !hasExpired(prior, now)) &#123;</span><br><span class="line">                    <span class="comment">// è®°å½•è®¿é—®æ—¶é—´å¹¶è¿”å›å½“å‰å€¼ï¼ˆä¸è¦†ç›–ï¼‰</span></span><br><span class="line">                    <span class="keyword">if</span> (!isComputingAsync(prior)) &#123;</span><br><span class="line">                        tryExpireAfterRead(prior, key, currentValue, expiry(), now);</span><br><span class="line">                        setAccessTime(prior, now);</span><br><span class="line">                    &#125;</span><br><span class="line">                    afterRead(prior, now, <span class="comment">/* recordHit */</span> <span class="literal">false</span>);</span><br><span class="line">                    <span class="keyword">return</span> currentValue;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// ========== åœºæ™¯2ï¼šé”®å­˜åœ¨ä¸”onlyIfAbsentä¸ºtrue ==========</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (onlyIfAbsent) &#123;</span><br><span class="line">            <span class="comment">// å¿«é€Ÿè·¯å¾„ï¼šä¸è¦†ç›–ç°æœ‰å€¼ï¼Œåªè¿”å›å½“å‰å€¼</span></span><br><span class="line">            <span class="type">V</span> <span class="variable">currentValue</span> <span class="operator">=</span> prior.getValue();</span><br><span class="line">            <span class="keyword">if</span> ((currentValue != <span class="literal">null</span>) &amp;&amp; !hasExpired(prior, now)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!isComputingAsync(prior)) &#123;</span><br><span class="line">                    tryExpireAfterRead(prior, key, currentValue, expiry(), now);</span><br><span class="line">                    setAccessTime(prior, now);</span><br><span class="line">                &#125;</span><br><span class="line">                afterRead(prior, now, <span class="comment">/* recordHit */</span> <span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">return</span> currentValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ========== å¤„ç†èŠ‚ç‚¹çŠ¶æ€å¼‚å¸¸æƒ…å†µ ==========</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¹‹å‰è·å–çš„èŠ‚ç‚¹å·²å¤±æ•ˆï¼ˆå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ç§»é™¤ï¼‰ï¼Œåˆ™é‡è¯•</span></span><br><span class="line">        <span class="keyword">if</span> (!prior.isAlive()) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœé‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼ˆå¦‚è‡ªæ—‹ç­‰å¾…åä»æ— æ•ˆï¼‰ï¼Œåˆ™é€šè¿‡è®¡ç®—æ“ä½œç¡®ä¿èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">if</span> ((attempts &amp; MAX_PUT_SPIN_WAIT_ATTEMPTS) != <span class="number">0</span>) &#123;</span><br><span class="line">                Thread.onSpinWait(); <span class="comment">// æç¤ºCPUè¿›è¡Œè‡ªæ—‹ç­‰å¾…ä¼˜åŒ–</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é€šè¿‡computeIfPresentæ–¹æ³•å¤„ç†ï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹å­˜æ´»çŠ¶æ€ä¸‹è¿›è¡Œæ“ä½œ</span></span><br><span class="line">            data.computeIfPresent(lookupKey, (k, n) -&gt; &#123;</span><br><span class="line">                requireIsAlive(key, n);</span><br><span class="line">                <span class="keyword">return</span> n;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ========== åœºæ™¯3ï¼šé”®å­˜åœ¨ä¸”éœ€è¦æ›´æ–°å€¼ ==========</span></span><br><span class="line">        <span class="comment">// ä»¥ä¸‹å˜é‡ç”¨äºè®°å½•æ›´æ–°è¿‡ç¨‹ä¸­çš„çŠ¶æ€</span></span><br><span class="line">        V oldValue;</span><br><span class="line">        <span class="type">long</span> varTime; <span class="comment">// æ–°çš„å¯å˜è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        <span class="type">int</span> oldWeight; <span class="comment">// æ—§æƒé‡å€¼</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">expired</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">// æ ‡è®°æ—§å€¼æ˜¯å¦å·²è¿‡æœŸ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">mayUpdate</span> <span class="operator">=</span> <span class="literal">true</span>; <span class="comment">// æ˜¯å¦å…è®¸æ›´æ–°</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exceedsTolerance</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">// æ˜¯å¦è¶…è¿‡æ—¶é—´å®¹å¿åº¦</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹ç°æœ‰èŠ‚ç‚¹åŠ é”ï¼Œç¡®ä¿æ›´æ–°æ“ä½œçš„åŸå­æ€§</span></span><br><span class="line">        <span class="keyword">synchronized</span> (prior) &#123;</span><br><span class="line">            <span class="comment">// å†æ¬¡æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼ˆé˜²æ­¢åœ¨è·å–é”æœŸé—´çŠ¶æ€å˜åŒ–ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (!prior.isAlive()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>; <span class="comment">// å¦‚æœèŠ‚ç‚¹ä¸å†å­˜æ´»ï¼Œé‡è¯•</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è·å–æ—§å€¼å’Œæ—§æƒé‡</span></span><br><span class="line">            oldValue = prior.getValue();</span><br><span class="line">            oldWeight = prior.getWeight();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ ¹æ®ä¸åŒçš„æƒ…å†µè®¡ç®—æ–°çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span> (oldValue == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ—§å€¼å·²è¢«åƒåœ¾å›æ”¶ï¼Œè§†ä¸ºæ–°åˆ›å»º</span></span><br><span class="line">                varTime = expireAfterCreate(key, value, expiry, now);</span><br><span class="line">                notifyEviction(key, <span class="literal">null</span>, RemovalCause.COLLECTED);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hasExpired(prior, now)) &#123;</span><br><span class="line">                <span class="comment">// èŠ‚ç‚¹å·²è¿‡æœŸï¼ŒæŒ‰æ–°åˆ›å»ºå¤„ç†</span></span><br><span class="line">                expired = <span class="literal">true</span>;</span><br><span class="line">                varTime = expireAfterCreate(key, value, expiry, now);</span><br><span class="line">                notifyEviction(key, oldValue, RemovalCause.EXPIRED);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (onlyIfAbsent) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœonlyIfAbsentä¸ºtrueï¼Œåˆ™ä¸æ›´æ–°å€¼ï¼Œåªæ›´æ–°è®¿é—®æ—¶é—´</span></span><br><span class="line">                mayUpdate = <span class="literal">false</span>;</span><br><span class="line">                varTime = expireAfterRead(prior, key, value, expiry, now);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ­£å¸¸æ›´æ–°ï¼Œè®¡ç®—æ›´æ–°åçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                varTime = expireAfterUpdate(prior, key, value, expiry, now);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå…è®¸æ›´æ–°å€¼ï¼Œåˆ™æ‰§è¡Œæ›´æ–°æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (mayUpdate) &#123;</span><br><span class="line">                <span class="comment">// æ£€æŸ¥æ˜¯å¦è¶…è¿‡å†™å…¥å®¹å¿åº¦ï¼ˆç”¨äºæ§åˆ¶æ›´æ–°é¢‘ç‡ï¼Œé¿å…é¢‘ç¹ç»´æŠ¤ï¼‰</span></span><br><span class="line">                exceedsTolerance = (expiresAfterWrite() &amp;&amp; (now - prior.getWriteTime()) &gt; EXPIRE_WRITE_TOLERANCE)</span><br><span class="line">                        || (expiresVariable() &amp;&amp; Math.abs(varTime - prior.getVariableTime()) &gt; EXPIRE_WRITE_TOLERANCE);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ›´æ–°èŠ‚ç‚¹çš„å€¼å’Œæƒé‡</span></span><br><span class="line">                prior.setValue(value, valueReferenceQueue());</span><br><span class="line">                prior.setWeight(newWeight);</span><br><span class="line">                setWriteTime(prior, now);</span><br><span class="line">                discardRefresh(prior.getKeyReference()); <span class="comment">// ä¸¢å¼ƒå¯èƒ½çš„åˆ·æ–°ä»»åŠ¡</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®¾ç½®èŠ‚ç‚¹çš„å¯å˜æ—¶é—´ï¼ˆç”¨äºè¿‡æœŸç­–ç•¥ï¼‰å’Œè®¿é—®æ—¶é—´</span></span><br><span class="line">            setVariableTime(prior, varTime);</span><br><span class="line">            setAccessTime(prior, now);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ========== é€šçŸ¥ç›¸å…³äº‹ä»¶ ==========</span></span><br><span class="line">        <span class="keyword">if</span> (expired) &#123;</span><br><span class="line">            notifyRemoval(key, oldValue, RemovalCause.EXPIRED);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldValue == <span class="literal">null</span>) &#123;</span><br><span class="line">            notifyRemoval(key, <span class="comment">/* oldValue */</span> <span class="literal">null</span>, RemovalCause.COLLECTED);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mayUpdate) &#123;</span><br><span class="line">            notifyOnReplace(key, oldValue, value); <span class="comment">// é€šçŸ¥å€¼è¢«æ›¿æ¢</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ========== å†³å®šåç»­ç»´æŠ¤æ“ä½œ ==========</span></span><br><span class="line">        <span class="comment">// è®¡ç®—æƒé‡å˜åŒ–</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">weightedDifference</span> <span class="operator">=</span> mayUpdate ? (newWeight - oldWeight) : <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ¹æ®æ¡ä»¶å†³å®šæ‰§è¡Œå†™åæ“ä½œè¿˜æ˜¯è¯»åæ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> ((oldValue == <span class="literal">null</span>) || (weightedDifference != <span class="number">0</span>) || expired) &#123;</span><br><span class="line">            <span class="comment">// éœ€è¦æ‰§è¡Œå†™åç»´æŠ¤ï¼ˆå¦‚å¤§å°è°ƒæ•´ã€é©±é€æ£€æŸ¥ç­‰ï¼‰</span></span><br><span class="line">            afterWrite(<span class="keyword">new</span> <span class="title class_">UpdateTask</span>(prior, weightedDifference));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!onlyIfAbsent &amp;&amp; exceedsTolerance) &#123;</span><br><span class="line">            <span class="comment">// å³ä½¿å€¼æœªå˜ï¼Œä½†æ—¶é—´åå·®è¶…è¿‡å®¹å¿åº¦ï¼Œä¹Ÿéœ€è¦å†™åç»´æŠ¤</span></span><br><span class="line">            afterWrite(<span class="keyword">new</span> <span class="title class_">UpdateTask</span>(prior, weightedDifference));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ä»…è®°å½•è®¿é—®ï¼ˆè½»é‡çº§æ“ä½œï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (mayUpdate) &#123;</span><br><span class="line">                setWriteTime(prior, now);</span><br><span class="line">            &#125;</span><br><span class="line">            afterRead(prior, now, <span class="comment">/* recordHit */</span> <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›æ—§å€¼ï¼ˆå¦‚æœè¿‡æœŸåˆ™è¿”å›nullï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> expired ? <span class="literal">null</span> : oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>data.put(keyRef,node)</p>
<p>writeBuffer.offer(task);</p>
<p>schedule</p>
<p>end</p>
<p>&#x2F;&#x2F;å†™å…¥writeBuffer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterWrite</span><span class="params">(Runnable task)</span> &#123;</span><br><span class="line">  <span class="comment">//å†™å…¥ç„¶åæ»¡äº† å°±ä¼šé‡è¯• é»˜è®¤140æ¬¡</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; WRITE_BUFFER_RETRIES; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (writeBuffer.offer(task)) &#123;</span><br><span class="line">      scheduleAfterWrite();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    scheduleDrainBuffers();</span><br><span class="line">    Thread.onSpinWait();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// In scenarios where the writing threads cannot make progress then they attempt to provide</span></span><br><span class="line">  <span class="comment">// assistance by performing the eviction work directly. This can resolve cases where the</span></span><br><span class="line">  <span class="comment">// maintenance task is scheduled but not running. That might occur due to all of the executor&#x27;s</span></span><br><span class="line">  <span class="comment">// threads being busy (perhaps writing into this cache), the write rate greatly exceeds the</span></span><br><span class="line">  <span class="comment">// consuming rate, priority inversion, or if the executor silently discarded the maintenance</span></span><br><span class="line">  <span class="comment">// task. Unfortunately this cannot resolve when the eviction is blocked waiting on a long-</span></span><br><span class="line">  <span class="comment">// running computation due to an eviction listener, the victim is being computed on by a writer,</span></span><br><span class="line">  <span class="comment">// or the victim residing in the same hash bin as a computing entry. In those cases a warning is</span></span><br><span class="line">  <span class="comment">// logged to encourage the application to decouple these computations from the map operations.</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//é‡è¯•åè¿˜æ˜¯å†™å…¥ä¸äº†ï¼Œå°±ä¼šä¸»åŠ¨åŒæ­¥è°ƒèµ·maintenanceï¼šæ¶ˆè´¹Buffer æ¸…ç†key æ·˜æ±°key</span></span><br><span class="line">  lock();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    maintenance(task);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">    logger.log(Level.ERROR, <span class="string">&quot;Exception thrown when performing the maintenance task&quot;</span>, e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    evictionLock.unlock();</span><br><span class="line">  &#125;</span><br><span class="line">  rescheduleCleanUpIfIncomplete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>maintenance</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GuardedBy(&quot;evictionLock&quot;)</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">maintenance</span><span class="params">(<span class="meta">@Nullable</span> Runnable task)</span> &#123;</span><br><span class="line">    setDrainStatusRelease(PROCESSING_TO_IDLE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      drainReadBuffer();</span><br><span class="line"></span><br><span class="line">      drainWriteBuffer();</span><br><span class="line">      <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">        task.run();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      drainKeyReferences();</span><br><span class="line">      drainValueReferences();</span><br><span class="line"></span><br><span class="line">      expireEntries();</span><br><span class="line">      evictEntries();</span><br><span class="line"></span><br><span class="line">      climb();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((drainStatusOpaque() != PROCESSING_TO_IDLE)</span><br><span class="line">          || !casDrainStatus(PROCESSING_TO_IDLE, IDLE)) &#123;</span><br><span class="line">        setDrainStatusOpaque(REQUIRED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è‹¥ï¼šwriteBufferæ»¡äº†ï¼Œoffer return falseã€‚å¼‚æ­¥ä»»åŠ¡å¤„ç†ä¸è¿‡æ¥ï¼Œå¾ªç¯å®Œæˆåï¼Œä¼šä¸»åŠ¨åŒæ­¥è°ƒå…¶maintanceï¼ˆè¿™æ—¶å€™putå°±ä¼šè¢«é˜»å¡ï¼Œå…¶å®æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿæ˜¯ä¸€ç§ä¿æŠ¤æªæ–½ï¼Œå› ä¸ºå†™å¤ªå¤šï¼Œä¼šOOMï¼Œé˜»å¡ä¹Ÿä¼šå»å‡æ…¢å†™çš„é€Ÿåº¦ï¼‰ï¼šå°±ä¼šå»æ¶ˆè´¹Bufferï¼ŒèŠ‚ç‚¹è¿‡æœŸï¼ŒèŠ‚ç‚¹æ·˜æ±°ã€‚å¦‚æœéå¸¸çˆ†ç‚¸æ€§çš„putçš„ç”»ï¼Œæ€§èƒ½å°±ä¸æ˜¯å¾ˆå¥½äº†</p>
<p>è¯»å¤šå†™å°‘ç”¨çš„æ‰æ˜¯æœ¬åœ°ç¼“å­˜</p>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p>get -&gt; data -&gt; readBuffer.offer(æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå‡å°‘äº†ç«äº‰) </p>
<h3 id="å¼‚æ­¥ä»»åŠ¡"><a href="#å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡"></a>å¼‚æ­¥ä»»åŠ¡</h3><p>ä¼šè¢«åŒ…è£…æˆPerformCleanUpTaskå®ƒå…¶å®æ˜¯ä¸€ä¸ªRunnableï¼Œç„¶åä¸¢åˆ°çº¿ç¨‹æ± å»æ‰§è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GuardedBy(&quot;evictionLock&quot;)</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">maintenance</span><span class="params">(<span class="meta">@Nullable</span> Runnable task)</span> &#123;</span><br><span class="line">    setDrainStatusRelease(PROCESSING_TO_IDLE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      drainReadBuffer();</span><br><span class="line"></span><br><span class="line">      drainWriteBuffer();</span><br><span class="line">      <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">        task.run();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      drainKeyReferences();</span><br><span class="line">      drainValueReferences();</span><br><span class="line"></span><br><span class="line">      expireEntries();</span><br><span class="line">      evictEntries();</span><br><span class="line"></span><br><span class="line">      climb();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((drainStatusOpaque() != PROCESSING_TO_IDLE)</span><br><span class="line">          || !casDrainStatus(PROCESSING_TO_IDLE, IDLE)) &#123;</span><br><span class="line">        setDrainStatusOpaque(REQUIRED);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="å†…å­˜ç®¡ç†ï¼Œï¼ˆæ·˜æ±°ç­–ç•¥ï¼škeyä¸Šé™ï¼‰ï¼ŒW-TinyLFU"><a href="#å†…å­˜ç®¡ç†ï¼Œï¼ˆæ·˜æ±°ç­–ç•¥ï¼škeyä¸Šé™ï¼‰ï¼ŒW-TinyLFU" class="headerlink" title="å†…å­˜ç®¡ç†ï¼Œï¼ˆæ·˜æ±°ç­–ç•¥ï¼škeyä¸Šé™ï¼‰ï¼ŒW-TinyLFU"></a>å†…å­˜ç®¡ç†ï¼Œï¼ˆæ·˜æ±°ç­–ç•¥ï¼škeyä¸Šé™ï¼‰ï¼ŒW-TinyLFU</h3><p>åƒå†…å­˜ç®¡ç†ï¼Œæˆ‘è‚¯å®šæ˜¯æœ‰å†…å­˜çš„æ•°æ®æ‰èƒ½è¿›è¡Œç®¡ç†ï¼Œè€Œåƒè¿™äº›æ•°æ®æˆ‘è‚¯å®šæ˜¯ä¸èƒ½åœ¨put or get çš„ä¸»çº¿ç¨‹å»åšçš„ï¼Œæœ‰äº›å†…å­˜ç»„ä»¶å…¶å®å°±æ˜¯è¿™ä¹ˆå»åšçš„ï¼Œæ‰€ä»¥æ€§èƒ½æ‰å·®</p>
<p>writeBufferå’ŒreadBufferçš„ä½œç”¨ï¼šå°±æ˜¯æŠŠç»Ÿè®¡æ“ä½œå’Œè¯»å†™æ“ä½œåˆ†ç¦»äº†ï¼ˆä¸€å®šæƒ…å†µä¸‹ï¼‰ï¼Œä¸¤è€…ä¸ä¼šç›¸äº’å½±å“</p>
<p><img src="/images/ca25f76684eeb3f6c83a18c5002568ab.png"></p>
<p>å†…å­˜æ¨¡å‹ï¼š</p>
<p>è¿‡æœŸç­–ç•¥</p>
<ol>
<li>å…¨å±€ç»Ÿä¸€keyä¸€ä¸ªè¿‡æœŸæ—¶é—´</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">expireAfterWriteEntries</span><span class="params">(<span class="type">long</span> now)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!expiresAfterWrite()) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> expiresAfterWriteNanos();<span class="comment">//å…¨å±€è¿‡æœŸæ—¶é—´ å¦‚ 10ç§’</span></span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    Node&lt;K, V&gt; node = writeOrderDeque().peekFirst();</span><br><span class="line">    <span class="keyword">if</span> ((node == <span class="literal">null</span>) || ((now - node.getWriteTime()) &lt; duration) <span class="comment">//åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">        || !evictEntry(node, RemovalCause.EXPIRED, now)) &#123; <span class="comment">//å»æ·˜æ±°</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line"><span class="keyword">if</span> (expiresAfterWrite()) &#123;</span><br><span class="line">  expired |= ((now - n.getWriteTime()) &gt;= expiresAfterWriteNanos());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//å·²è¿‡æœŸ</span></span><br><span class="line">makeDead(n);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å·²è¿‡æœŸ</span></span><br><span class="line">removed[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//æŠŠdate ç»™ put(keyï¼Œ null)ï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//..</span></span><br><span class="line"><span class="comment">//ç§»é™¤å†™é¡ºåºé˜Ÿåˆ—ï¼Œå¥½ç­‰ä¸‹ä¸€æ¬¡å¾ªç¯å†æ¬¡peekFirstè¿›è¡Œè¿‡æœŸæ£€æŸ¥</span></span><br><span class="line">writeOrderDeque().remove(node);</span><br><span class="line"></span><br><span class="line"><span class="comment">//..</span></span><br><span class="line"><span class="comment">//å‘å‡ºç§»é™¤keyé€šçŸ¥ï¼Œå¯è‡ªå®šä¹‰ç›‘å¬å™¨</span></span><br><span class="line">notifyRemoval(key, value[<span class="number">0</span>], actualCause[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ¯ä¸ªkeyå•ç‹¬ä¸€ä¸ªè¿‡æœŸæ—¶é—´</li>
</ol>
<p>ä½¿ç”¨çš„æ˜¯æ—¶é—´è½®ç®—æ³•ï¼Œæ—¶é—´è½®ç®—æ³•è¿‡æœŸ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">expireVariableEntries</span><span class="params">(<span class="type">long</span> now)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (expiresVariable()) &#123;</span><br><span class="line">    timerWheel().advance(now);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ—¶é—´è½®ï¼šæœ¬è´¨å…¶å®å°±æ˜¯ æ•°ç»„ + é“¾è¡¨</p>
<p>å®šæ—¶å™¨tickä»æ—¶é—´è½®é‡Œå–ä»»åŠ¡æ—¶ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦å¯ä»¥ä¸ºO(1);</p>
<p>åŒ…æ‹¬putä¹Ÿæ˜¯</p>
<p>è€ŒåƒLinuxçš„åŒå±‚æ—¶é—´è½®ï¼Œåœ¨æ¬¡åŸºç¡€ä¸Šè¿˜ä¼˜åŒ–äº†ã€‚é‡‡ç”¨äº†åŒå±‚æ—¶é—´è½®ï¼Œæ”¯æŒé«˜å»¶è¿Ÿï¼Œå…¶è®¾è®¡æ€æƒ³ç±»ä¼¼äºåˆ†é’ˆå’Œç§’é’ˆ</p>
<p><img src="/images/725032b3a5d94b99a4b035ed40373971.png"></p>
<p>ã€å±‚1ï¼šç§’è½®ï¼ˆå¿«é€Ÿè½®ï¼‰ã€‘<br>slot0 slot1 slot2 â€¦ slot59</p>
<p>ã€å±‚2ï¼šåˆ†è½®ï¼ˆæ…¢é€Ÿè½®ï¼‰ã€‘<br>slot0 slot1 â€¦ slot59</p>
<p>Tick æ¨è¿›æ—¶ï¼š</p>
<ul>
<li>ç§’è½®æ¯èµ°ä¸€æ ¼</li>
<li>ç§’è½®èµ°æ»¡ä¸€åœˆ â†’ åˆ†è½®å‰è¿›ä¸€æ­¥ï¼Œå¹¶å°†è¯¥åˆ†è½®æ§½å†…çš„ä»»åŠ¡ä¸‹æ²‰åˆ°ç§’è½®å¯¹åº”æ§½</li>
</ul>
</blockquote>
<p>æ·˜æ±°ç­–ç•¥ï¼šW-TinyLFU</p>
<p>æ€æƒ³å¤§ä½“å°±æ˜¯æˆ‘è§‰å¾—å°±å¾ˆåƒjvmçš„é‚£ç§åˆ†ä»£æ€æƒ³ã€‚åƒè¿™ä¸ªW-TinyLFUç®—æ³•ï¼Œå®ƒçš„è¯å°±æ˜¯æŠŠå†…å­˜æ€»çš„åˆ†æˆäº†ä¸¤ç«¯ï¼Œä¸€ä¸ªmain cacheï¼Œä¸€ä¸ªæ˜¯windows Cacheï¼Œè€Œmain cacheé‡Œåˆåˆ†ä¸ºprobation(LRU)ï¼ˆè¯•ç”¨æœŸï¼‰ å’Œ protected(LRU)ï¼ˆå—ä¿æŠ¤çš„ï¼‰ã€‚ï¼ˆW-TinyLRU é€šå¸¸åŒ…å« <strong>ä¸¤ä¸ªä¸»è¦ç»„ä»¶</strong>ï¼šwindowCacheå’ŒmainCacheï¼‰</p>
<p>å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>å½“å‰ä¸€ä¸ªæ–°çš„itemè¿›æ¥æ—¶ï¼Œä¼šå…ˆè¿›å…¥æˆ‘ä»¬çš„windowCacheã€‚è¿™é‡Œçš„windowCacheæ¯”è¾ƒå°ï¼Œä¸”å†…å­˜ç®¡ç†å°±ç›´æ¥ä½¿ç”¨ä¼ ç»ŸLRUäº†ã€‚</li>
<li>è‹¥æœ‰itemä»æˆ‘ä»¬çš„windowCacheæ·˜æ±°å‡ºæ¥çš„è¯ï¼Œä¼šå°è¯•è¿›å…¥mainCache<ol>
<li>èƒ½å¦è¿›å…¥çœ‹TinyCacheå¯¹è¯¥itemçš„è®¡æ•°æ˜¯å¦ å¤§äº  ä¸»ç¼“å­˜ä¸­é¢‘ç‡æœ€ä½çš„å€™é€‰æ·˜æ±°å¯¹è±¡ çš„ é¢‘ç‡è®¡æ•°ã€‚å¯ä»¥å°±è¿›å…¥å¹¶ï¼Œä¸å¯ä»¥å°±out</li>
</ol>
</li>
<li>mainCacheæ•´ä½“é‡‡ç”¨çš„ä¹Ÿæ˜¯LRUï¼ˆä½†æ˜¯ï¼‰</li>
<li>æ•´ä½“æµç¨‹å‘ˆç°ä¸€ç§ å…ˆæ¥çº³åæ·˜æ±°çš„æµç¨‹</li>
</ol>
<p><img src="/images/88b1020d3586dfb2c4d17a7f8a74d5c1.png"></p>
<p>MainCacheé‡Œçš„çŠ¶æ€æµè½¬</p>
<p><img src="/images/70736641535eb3b446ad5109a8923980.png"></p>
<p><img src="/images/f1839f3881e11e6dd3e65f33b027fbc1.png"></p>
<p>W-TinyLFUè§£å†³äº†LRUå’ŒLFUä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<ol>
<li>LRUï¼šçªå‘æµé‡æ±¡æŸ“é—®é¢˜</li>
<li>LFUï¼šè€èµ„å†ä¸è…¾ç©ºç»™ æ–°æ•°æ®</li>
</ol>
<p><img src="/images/af8fd933ab4f066bbdcb040455c3cf9c.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ·˜æ±°èŠ‚ç‚¹</span></span><br><span class="line">evictEntries();</span><br><span class="line"><span class="comment">//..</span></span><br><span class="line"><span class="comment">//å…ˆwindow å†main</span></span><br><span class="line"><span class="type">int</span> <span class="variable">candidates</span> <span class="operator">=</span> evictFromWindow();</span><br><span class="line">evictFromMain(candidates);</span><br><span class="line"></span><br><span class="line"><span class="comment">//evictFromWindow</span></span><br><span class="line">Node&lt;K, V&gt; node = accessOrderWindowDeque().peek();</span><br><span class="line"><span class="comment">//è®¾100ä¸ªsize</span></span><br><span class="line"><span class="comment">//1ä¸ªç»™window  99ä¸ªç»™mainåŒº</span></span><br><span class="line"><span class="keyword">while</span> (windowWeightedSize() &gt; windowMaximum()) &#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">    accessOrderWindowDeque().remove(node);</span><br><span class="line">    accessOrderProbationDeque().add(node);</span><br><span class="line"></span><br><span class="line"><span class="comment">//..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//evictFromMain</span></span><br><span class="line"><span class="comment">//probationåŒºçš„ç¬¬ä¸€ä¸ª</span></span><br><span class="line">Node&lt;K, V&gt; victim = accessOrderProbationDeque().peekFirst();</span><br><span class="line"><span class="comment">//probationåŒºçš„æœ«å°¾ä¸ªï¼Œä¹Ÿå°±æ˜¯åˆšæ‰ä»windowç§»è¿‡æ¥çš„</span></span><br><span class="line">Node&lt;K, V&gt; candidate = accessOrderProbationDeque().peekLast();</span><br><span class="line"><span class="comment">//keyä¸ªæ•°æœ‰æ²¡æœ‰è¶…è¿‡ä¸Šé™</span></span><br><span class="line"><span class="keyword">while</span> (weightedSize() &gt; maximum()) &#123;</span><br><span class="line">    <span class="comment">//........</span></span><br><span class="line">    <span class="comment">//å¯¹æ¯”é¢‘ç‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//W - TinyLFUçš„ç²¾é«“</span></span><br><span class="line">    <span class="comment">//è®¡æ•°</span></span><br><span class="line">    admit(candidateKey, victimKey)ï¼›<span class="comment">//frequencySketch() å¾ˆå¥½çš„æ€æƒ³ï¼Œç‰¹æ®Šçš„ä½è®¡æ•°æ³•ï¼Œ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">    evictEntry(evict, RemovalCause.SIZE, <span class="number">0L</span>);</span><br><span class="line">    </span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªåŠ¨è°ƒèŠ‚å„åŒºåŸŸå¤§å°</span></span><br><span class="line">climb();</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(38, 38, 38);">W-TinyLFU çš„ç²¾é«“æ˜¯ ä½è®¡æ•°æ³•</font></p>
<p><font style="color:rgb(38, 38, 38);">å¦‚ä½•ä¸€ä¸ªé«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜ç»„ä»¶ï¼Œcaffeineåœ¨æ‹¼å¤šå¤šé«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯ä¸‹æ€§èƒ½è¿˜æ˜¯ä¸è¡Œ</font></p>
<h2 id="æ”¹è¿›ç¼ºç‚¹"><a href="#æ”¹è¿›ç¼ºç‚¹" class="headerlink" title="æ”¹è¿›ç¼ºç‚¹"></a><font style="color:rgb(38, 38, 38);">æ”¹è¿›ç¼ºç‚¹</font></h2><ol>
<li>ç»™ä¸åŒkeyè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼ŒAPIä¸å¤Ÿå¥½</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(K key, V value, Duration timeout)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(timeout == <span class="literal">null</span>) cache.put(k, v);</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        cache.policy() </span><br><span class="line">            .expireVariably()</span><br><span class="line">            .ifPresent(policy -&gt; policy.put(key, value, timeout));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2. </p>
<h2 id="å¯¹æ¯”guava-æ¶æ„"><a href="#å¯¹æ¯”guava-æ¶æ„" class="headerlink" title="å¯¹æ¯”guava æ¶æ„"></a><font style="color:rgb(38, 38, 38);">å¯¹æ¯”guava æ¶æ„</font></h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/13/%E9%A1%B9%E7%9B%AE/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E5%B9%B3%E5%8F%B0/%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/13/%E9%A1%B9%E7%9B%AE/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E5%B9%B3%E5%8F%B0/%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">æ€è€ƒ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-13 01:54:47 / ä¿®æ”¹æ—¶é—´ï¼š20:37:14" itemprop="dateCreated datePublished" datetime="2025-08-13T01:54:47+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">é¡¹ç›®</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A1%B9%E7%9B%AE/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E5%B9%B3%E5%8F%B0/" itemprop="url" rel="index"><span itemprop="name">æ¶ˆæ¯æ¨é€å¹³å°</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="æ•´ä¸ªé“¾è·¯"><a href="#æ•´ä¸ªé“¾è·¯" class="headerlink" title="æ•´ä¸ªé“¾è·¯"></a>æ•´ä¸ªé“¾è·¯</h2><h2 id="é«˜é€Ÿé˜Ÿåˆ—"><a href="#é«˜é€Ÿé˜Ÿåˆ—" class="headerlink" title="é«˜é€Ÿé˜Ÿåˆ—"></a>é«˜é€Ÿé˜Ÿåˆ—</h2><p>åŸºäºæé—®è€…çš„è¿™ä¸ªé—®é¢˜ï¼Œæ­ªå¸ˆå‚…ä¹Ÿæƒ³èµ·äº†ä¸¤ä¸ªç±»ä¼¼çš„åœºæ™¯ã€‚</p>
<p>ä¸€ä¸ªæ˜¯æˆ‘å‚ä¸å¼€å‘è¿‡çš„ä¸€ä¸ªå¯¹å®¢å‘é€çŸ­ä¿¡çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œç®€åŒ–ä¸€ä¸‹æ•´ä¸ªæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/images/182a3af28783e1e4bb1899f9add1b85a.png"></p>
<p>ä¸Šé¢è¿™ä¸ªå›¾ç‰‡ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<p>å°±æ˜¯æ¶ˆæ¯å †ç§¯ã€‚</p>
<p>å½“æŸä¸ªä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨çŸ­ä¿¡å‘é€æ¥å£ï¼Œæ‰¹é‡å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ¯”å¦‚å‘é€è¥é”€æ´»åŠ¨æ—¶ï¼Œå¤§é‡çš„æ¶ˆæ¯å°±åœ¨é˜Ÿåˆ—é‡Œé¢å †ç€ï¼Œæ…¢æ…¢æ¶ˆè´¹ã€‚</p>
<p>å…¶å®å †ç§¯ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæ¯•ç«Ÿè¥é”€æ´»åŠ¨çš„å®æ—¶æ€§è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œä¸è¦æ±‚ç«‹é©¬å‘é€åˆ°å®¢æˆ·æ‰‹æœºä¸Šå»ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ¶ˆæ¯å †ç§¯èµ·æ¥ä¹‹åï¼Œçªç„¶æœ‰ç”¨æˆ·ç”³è¯·äº†éªŒè¯ç çŸ­ä¿¡å‘¢ï¼Ÿ</p>
<p><img src="/images/313eb58937c7b6d39cfb539f308e812b.png"></p>
<p>éœ€è¦æŠŠå‰é¢å †ç§¯çš„æ¶ˆè´¹å®Œæˆåï¼Œæ‰ä¼šå‘é€éªŒè¯ç çŸ­ä¿¡ï¼Œè¿™ä¸ªå·²ç»æ¥ä¸åŠäº†ï¼Œç”šè‡³éªŒè¯ç å·²ç»è¿‡æœŸå¾ˆä¹…äº†ä½ æ‰å‘è¿‡å»ã€‚</p>
<p>å®¢æˆ·è‚¯å®šä¼šéª‚å¨˜ï¼Œå› ä¸ºè·å–ä¸åˆ°éªŒè¯ç ï¼Œä»–å°±ä¸èƒ½è¿›è¡Œåç»­ä¸šåŠ¡ã€‚</p>
<p>å¦‚æœå¤§é‡å®¢æˆ·å› ä¸ºæ”¶ä¸åˆ°éªŒè¯ç ä¸èƒ½è¿›è¡Œåç»­ä¸šåŠ¡ï¼Œå¼•èµ·ç¾¤ä½“æ€§çš„å®¢è¯‰ï¼Œç”šè‡³ç”¨æˆ·ææ…Œï¼Œè¿™ä¸ªå¯¹äºä¼ä¸šæ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„äº‹ä»¶ã€‚</p>
<p>æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è§£å†³æ–¹æ¡ˆéå¸¸ç®€å•ï¼Œå†æä¸€ä¸ªâ€œé«˜é€Ÿâ€é˜Ÿåˆ—å‡ºæ¥ï¼š</p>
<p><img src="/images/bc40d5d63eddda91ced5a81cfe17d9d3.png"></p>
<p>éªŒè¯ç æ¶ˆæ¯ç›´æ¥æ‰”åˆ°â€œé«˜é€Ÿâ€é˜Ÿåˆ—ä¸­å»ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸“é—¨ç”¨æ¥å¤„ç†éªŒè¯ç ã€åŠ¨è´¦é€šçŸ¥è¿™ä¸€ç±»æ—¶æ•ˆæ€§è¦æ±‚æé«˜çš„æ¶ˆæ¯ï¼Œä»ä¸šåŠ¡åœºæ™¯ä¸Šåˆ†æï¼Œä¹Ÿä¸ä¼šå‡ºç°æ¶ˆæ¯å †ç§¯ã€‚</p>
<p>ä¸æ˜¯ç‰¹åˆ«å¤æ‚çš„æ–¹æ¡ˆï¼Œå¤§é“è‡³ç®€ï¼Œé—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚</p>
<p>ç±»æ¯”åˆ°å‰é¢è¯´çš„â€œå¿«æ…¢â€çº¿ç¨‹æ± ï¼Œå…¶å®æ˜¯ä¸€æ ·çš„æ€æƒ³ï¼Œéƒ½æ˜¯ä»èµ„æºä¸Šè¿›è¡Œéš”ç¦»ã€‚</p>
<p>åªä¸è¿‡æˆ‘è¯´çš„è¿™ä¸ªåœºæ™¯æ›´åŠ ç®€å•ï¼Œä¸éœ€è¦å»æ”¶é›†ä¿¡æ¯è¿›è¡ŒåŠ¨æ€åˆ¤æ–­ã€‚ä¸šåŠ¡æµç¨‹ä¸Šå¤©ç„¶çš„å°±èƒ½åŒºåˆ†å‡ºæ¥ï¼Œå“ªäº›æ¶ˆæ¯å®æ—¶æ€§æ¯”è¾ƒé«˜ï¼Œåº”è¯¥èµ°â€œé«˜é€Ÿâ€é˜Ÿåˆ—ï¼›å“ªäº›æ¶ˆæ¯æ…¢æ…¢ å‘æ²¡å…³ç³»ï¼Œå¯ä»¥åº”è¯¥èµ°â€œå¸¸è§„â€é˜Ÿåˆ—ã€‚</p>
<p>è€Œè¿™ä¸ªæ‰€è°“çš„â€œé«˜é€Ÿâ€å’Œâ€œå¸¸è§„â€ï¼Œåªæ˜¯å¼€å‘äººå‘˜ç»™ä¸€ä¸ªæ™®é€šé˜Ÿåˆ—èµ‹äºˆçš„ä¸€ä¸ªå±æ€§è€Œå·²ï¼Œç«™åœ¨ MQ çš„è§’åº¦ï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/13/JavaSE/switch%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/13/JavaSE/switch%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/" class="post-title-link" itemprop="url">switchæ—¶é—´å¤æ‚åº¦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-13 01:50:47 / ä¿®æ”¹æ—¶é—´ï¼š01:51:04" itemprop="dateCreated datePublished" datetime="2025-08-13T01:50:47+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaSE/" itemprop="url" rel="index"><span itemprop="name">JavaSE</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/12/Dubbo%E4%BA%94%E7%A7%8D%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/12/Dubbo%E4%BA%94%E7%A7%8D%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" class="post-title-link" itemprop="url">Dubboäº”ç§è´Ÿè½½å‡è¡¡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-12 16:59:41" itemprop="dateCreated datePublished" datetime="2025-08-12T16:59:41+08:00">2025-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-18 13:26:18" itemprop="dateModified" datetime="2025-10-18T13:26:18+08:00">2025-10-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="æœ€çŸ­å“åº”æ—¶é—´ç­–ç•¥ï¼š"><a href="#æœ€çŸ­å“åº”æ—¶é—´ç­–ç•¥ï¼š" class="headerlink" title="æœ€çŸ­å“åº”æ—¶é—´ç­–ç•¥ï¼š"></a>æœ€çŸ­å“åº”æ—¶é—´ç­–ç•¥ï¼š</h2><ol>
<li>éå†æœåŠ¡æä¾›è€…ï¼Œè®¡ç®—æ¯ä¸ªæœåŠ¡çš„é¢„è®¡ç­‰å¾…æ—¶é—´ï¼š<code>(æˆåŠŸæ€»è€—æ—¶/æˆåŠŸè¯·æ±‚æ•°) * æ´»è·ƒæ•°</code>ã€‚</li>
<li>é€‰æ‹©æ—¶é—´æœ€çŸ­çš„æœåŠ¡ï¼Œè‹¥å¤šä¸ªåˆ™æŒ‰æƒé‡é€‰æ‹©ï¼Œæƒé‡ç›¸åŒåˆ™éšæœºã€‚</li>
</ol>
<h2 id="åŠ æƒè½®è¯¢ç®—æ³•"><a href="#åŠ æƒè½®è¯¢ç®—æ³•" class="headerlink" title="åŠ æƒè½®è¯¢ç®—æ³•"></a>åŠ æƒè½®è¯¢ç®—æ³•</h2><p>Dubboçš„åŠ æƒè½®è¯¢ç®—æ³•ç»å†äº†ä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼Œå…¶æ¼”è¿›ç›®æ ‡æ˜¯åœ¨ä¿è¯æŒ‰æƒé‡åˆ†é…è¯·æ±‚çš„å‰æä¸‹ï¼Œå…¼é¡¾æ€§èƒ½å’Œè¯·æ±‚åˆ†å¸ƒçš„å¹³æ»‘æ€§ã€‚</p>
<ol>
<li>Dubbo 2.6.4 ç‰ˆæœ¬åŠä¹‹å‰ï¼šå­˜åœ¨ä¸¥é‡æ€§èƒ½é—®é¢˜çš„æœ´ç´ å®ç°ã€‚</li>
<li>ç¬¬ä¸€æ¬¡ä¼˜åŒ–ï¼šä¿®å¤äº†æ€§èƒ½é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦é™è‡³O(1)ï¼Œä½†è¯·æ±‚åˆ†å¸ƒä¸å¹³æ»‘ã€‚</li>
<li>æœ€ç»ˆæ–¹æ¡ˆï¼ˆå¹³æ»‘åŠ æƒè½®è¯¢ï¼‰ï¼šåœ¨ä¿è¯O(1)æ—¶é—´å¤æ‚åº¦çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†å¹³æ»‘çš„è¯·æ±‚åˆ†å¸ƒï¼Œé¿å…äº†æŸä¸ªèŠ‚ç‚¹çŸ­æ—¶é—´å†…å‹åŠ›æ¿€å¢ã€‚</li>
</ol>
<p>è¯¥ç®—æ³•çš„çµæ„Ÿæ¥æºäºNginxçš„å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´ä¸€ä¸ªâ€œå½“å‰æƒé‡â€å€¼ï¼Œè®©è¯·æ±‚èƒ½å¤Ÿæ›´å‡åŒ€åœ°åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œä¸æ˜¯è¿ç»­åœ°åˆ†é…ç»™é«˜æƒé‡èŠ‚ç‚¹ã€‚</p>
<p><font style="color:rgb(0, 0, 0);">å¯¹äºæ¯ä¸€æ¬¡è¯·æ±‚ï¼Œé€‰æ‹©è¿‡ç¨‹å¦‚ä¸‹ï¼š</font></p>
<ol>
<li><strong><font style="color:rgb(0, 0, 0);">éå†å¹¶æ›´æ–°</font></strong><font style="color:rgb(0, 0, 0);">ï¼šéå†æ‰€æœ‰Invokerï¼Œå°†æ¯ä¸ªInvokerçš„</font><font style="color:rgb(0, 0, 0);"> </font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;current&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">å€¼åŠ ä¸Šå…¶å›ºå®šçš„</font><font style="color:rgb(0, 0, 0);"> </font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;weight&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">ã€‚</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">é€‰æ‹©æœ€å¤§è€…</font></strong><font style="color:rgb(0, 0, 0);">ï¼šä»æ­¥éª¤1æ›´æ–°åçš„</font><font style="color:rgb(0, 0, 0);"> </font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;current&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">å€¼ä¸­ï¼Œé€‰å‡ºæœ€å¤§çš„ä¸€ä¸ªã€‚è¯¥å€¼å¯¹åº”çš„Invokerå³ä¸ºæœ¬æ¬¡é€‰ä¸­çš„èŠ‚ç‚¹ã€‚</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">è°ƒæ•´é€‰ä¸­è€…æƒé‡</font></strong><font style="color:rgb(0, 0, 0);">ï¼šå°†</font><strong><font style="color:rgb(0, 0, 0);">é€‰ä¸­èŠ‚ç‚¹</font></strong><font style="color:rgb(0, 0, 0);">çš„</font><font style="color:rgb(0, 0, 0);"> </font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;current&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">å€¼å‡å»æ€»æƒé‡</font><font style="color:rgb(0, 0, 0);"> </font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;total&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">ã€‚</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">è¿”å›ç»“æœ</font></strong><font style="color:rgb(0, 0, 0);">ï¼šè¿”å›é€‰ä¸­çš„Invokerã€‚</font></li>
</ol>
<p><strong><font style="color:rgba(0, 0, 0, 0.4);">å…³é”®ç‚¹</font></strong><font style="color:rgba(0, 0, 0, 0.4);">ï¼šç¬¬3æ­¥â€œå‡å»æ€»æƒé‡â€æ˜¯ä¿è¯ç®—æ³•èƒ½å¤Ÿå¾ªç¯å¾€å¤ã€å®ç°å¹³æ»‘çš„æ ¸å¿ƒã€‚</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå®Œæ•´ä»£ç ï¼Œä»…ä¸ºè¯´æ˜ç®—æ³•é€»è¾‘</span></span><br><span class="line"><span class="keyword">protected</span> &lt;T&gt; Invoker&lt;T&gt; <span class="title function_">doSelect</span><span class="params">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç¬¬ä¸€ä¸ªInvokerå’Œå®ƒçš„å›ºå®šæƒé‡</span></span><br><span class="line">    Invoker&lt;T&gt; initInvoker = invokers.get(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">weight</span> <span class="operator">=</span> getWeight(initInvoker, invocation);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–æ‰€æœ‰Invokerçš„å½“å‰æƒé‡å’Œæ€»æƒé‡</span></span><br><span class="line">    <span class="comment">// `weightArray` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¿å­˜äº†æ¯ä¸ªInvokerçš„ã€å›ºå®šæƒé‡ã€‘å’Œã€å½“å‰æƒé‡ã€‘</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯ä¸ºäº†æ‰¾åˆ°æœ€å¤§çš„å›ºå®šæƒé‡å’Œæ€»æƒé‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">totalWeight</span> <span class="operator">=</span> weight;</span><br><span class="line">    <span class="type">int</span> <span class="variable">maxWeight</span> <span class="operator">=</span> weight;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line">        weight = getWeight(invokers.get(i), invocation);</span><br><span class="line">        maxWeight = Math.max(maxWeight, weight);</span><br><span class="line">        totalWeight += weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ ¸å¿ƒç®—æ³•å¾ªç¯</span></span><br><span class="line">    <span class="comment">// å¦‚æœæœ€å¤§æƒé‡å¤§äº0ï¼Œä¸”æ‰€æœ‰Invokerçš„å½“å‰æƒé‡ä¸å…¨éƒ½ç›¸ç­‰ï¼Œè¿›å…¥çŠ¶æ€æœºé€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (maxWeight &gt; <span class="number">0</span> &amp;&amp; !sameWeight) &#123;</span><br><span class="line">        <span class="comment">// çŠ¶æ€æœºæ¨¡å¼ï¼Œå¾ªç¯ç›´åˆ°é€‰å‡ºä¸€ä¸ªInvoker</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="comment">// å½“å‰ç´¢å¼•çš„Invokerï¼Œå°†å…¶ã€å½“å‰æƒé‡ã€‘å¢åŠ ã€å›ºå®šæƒé‡ã€‘</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> weightArray[i].current += weightArray[i].weight;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰å€¼å¤§äºå·²çŸ¥æœ€å¤§å€¼ï¼Œæ›´æ–°æœ€å¤§å€¼å’Œé€‰ä¸­çš„Invoker</span></span><br><span class="line">            <span class="keyword">if</span> (current &gt; maxCurrent) &#123;</span><br><span class="line">                maxCurrent = current;</span><br><span class="line">                selectedInvoker = invokers.get(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é€‰ä¸­åï¼Œå°†ã€é€‰ä¸­Invokerã€‘çš„ã€å½“å‰æƒé‡ã€‘å‡å»ã€æ€»æƒé‡ã€‘</span></span><br><span class="line">        <span class="comment">// è¿™æ˜¯å®ç°å¹³æ»‘çš„å…³é”®æ­¥éª¤ï¼</span></span><br><span class="line">        weightArray[selectedIndex].current -= totalWeight;</span><br><span class="line">        <span class="keyword">return</span> selectedInvoker;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. å¦‚æœæ‰€æœ‰æƒé‡ç›¸åŒï¼Œåˆ™é€€åŒ–ä¸ºæ™®é€šè½®è¯¢</span></span><br><span class="line">    <span class="keyword">return</span> invokers.get(sequence++ % length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0, 0, 0);">Dubboçš„åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ç®—æ³•é€šè¿‡ä¸‰æ¬¡æ¼”è¿›ï¼Œæœ€ç»ˆé‡‡ç”¨äº†</font><strong><font style="color:rgb(0, 0, 0);">å¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•</font></strong><font style="color:rgb(0, 0, 0);">ã€‚è¯¥ç®—æ³•é€šè¿‡å¼•å…¥åŠ¨æ€çš„â€œå½“å‰æƒé‡â€ï¼ˆ</font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;current&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">ï¼‰ï¼Œå¹¶åœ¨æ¯æ¬¡é€‰ä¸­åå‡å»â€œæ€»æƒé‡â€ï¼ˆ</font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;total&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">ï¼‰ï¼Œå·§å¦™åœ°å®ç°äº†ï¼š</font></p>
<ol>
<li><strong><font style="color:rgb(0, 0, 0);">ä¸¥æ ¼æŒ‰æƒé‡åˆ†é…</font></strong><font style="color:rgb(0, 0, 0);">ï¼šåœ¨å¤šæ¬¡è¯·æ±‚åï¼Œå„èŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¬¡æ•°æ¯”ä¸¥æ ¼ç­‰äºå…¶æƒé‡æ¯”ã€‚</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">è¯·æ±‚åˆ†å¸ƒå¹³æ»‘</font></strong><font style="color:rgb(0, 0, 0);">ï¼šé«˜æƒé‡èŠ‚ç‚¹çš„è¯·æ±‚è¢«åˆ†æ•£å¼€ï¼Œé¿å…äº†ç¬æ—¶å‹åŠ›è¿‡å¤§ã€‚</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">é«˜æ€§èƒ½</font></strong><font style="color:rgb(0, 0, 0);">ï¼šæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå…¶ä¸­næ˜¯æœåŠ¡èŠ‚ç‚¹æ•°ï¼Œé€šå¸¸å¾ˆå°ï¼Œå¯è§†ä¸ºå¸¸é‡çº§ã€‚</font></li>
</ol>
<p><font style="color:rgb(0, 0, 0);"></font></p>
<p><font style="color:rgb(0, 0, 0);"></font></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong><font style="color:rgb(0, 0, 0);">åŸç†</font></strong><font style="color:rgb(0, 0, 0);">ï¼š</font><ul>
<li><font style="color:rgb(0, 0, 0);">æœ€çŸ­å“åº”æ—¶é—´ç­–ç•¥ï¼šé€‰æ‹©å¹³å‡å“åº”æ—¶é—´æœ€çŸ­çš„æœåŠ¡ï¼Œç»“åˆæƒé‡å’Œæ´»è·ƒæ•°è®¡ç®—é¢„è®¡ç­‰å¾…æ—¶é—´ã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">æœ€å°æ´»è·ƒæ•°ç­–ç•¥ï¼šé€‰æ‹©æ´»è·ƒè¯·æ±‚æ•°æœ€å°‘çš„æœåŠ¡ï¼Œéœ€é…åˆ</font><code>&lt;font style=&quot;color:rgb(0, 0, 0);&quot;&gt;ActiveLimitFilter&lt;/font&gt;</code><font style="color:rgb(0, 0, 0);">ä½¿ç”¨ï¼Œå¦åˆ™é€€åŒ–ä¸ºåŠ æƒéšæœºã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">ä¸€è‡´æ€§å“ˆå¸Œç­–ç•¥ï¼šé€šè¿‡å“ˆå¸Œç¯å’Œè™šæ‹ŸèŠ‚ç‚¹åˆ†å¸ƒè¯·æ±‚ï¼Œå‡å°‘èŠ‚ç‚¹å˜åŠ¨æ—¶çš„æ•°æ®è¿ç§»ã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">åŠ æƒè½®è¯¢ç­–ç•¥ï¼šè¯·æ±‚æŒ‰æƒé‡æ¯”ä¾‹è½®æµåˆ†é…ï¼Œå¹³æ»‘åŠ æƒç®—æ³•é¿å…è¯·æ±‚é›†ä¸­ã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">åŠ æƒéšæœºç­–ç•¥ï¼šæ ¹æ®æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ï¼Œæƒé‡è¶Šå¤§çš„æœåŠ¡è¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šé«˜ã€‚</font></li>
</ul>
</li>
<li><strong><font style="color:rgb(0, 0, 0);">ä½œç”¨</font></strong><font style="color:rgb(0, 0, 0);">ï¼šä¼˜åŒ–èµ„æºåˆ©ç”¨ã€æå‡å“åº”é€Ÿåº¦ã€ä¿è¯é«˜å¯ç”¨æ€§ã€‚</font></li>
<li><strong><font style="color:rgb(0, 0, 0);">åº”ç”¨åœºæ™¯</font></strong><font style="color:rgb(0, 0, 0);">ï¼š</font><ul>
<li><font style="color:rgb(0, 0, 0);">æœ€çŸ­å“åº”æ—¶é—´ï¼šé€‚ç”¨äºå¯¹å»¶è¿Ÿæ•æ„Ÿçš„åœºæ™¯ï¼Œå¦‚å®æ—¶è®¡ç®—ã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">æœ€å°æ´»è·ƒæ•°ï¼šé€‚åˆå¤„ç†æ—¶é—´å·®å¼‚å¤§çš„æœåŠ¡ï¼Œå¦‚æ…¢æŸ¥è¯¢ä¼˜åŒ–ã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">ä¸€è‡´æ€§å“ˆå¸Œï¼šéœ€è¦ä¼šè¯ä¿æŒæˆ–é¡ºåºå¤„ç†çš„åœºæ™¯ï¼Œå¦‚ç¼“å­˜åˆ†ç‰‡ã€‚</font></li>
<li><font style="color:rgb(0, 0, 0);">åŠ æƒè½®è¯¢&#x2F;éšæœºï¼šæœåŠ¡å™¨æ€§èƒ½ä¸å‡æ—¶ï¼ŒæŒ‰æƒé‡åˆ†é…è´Ÿè½½ã€‚</font></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/10/%E8%AE%A1%E7%BD%91/IP/IP%E5%88%86%E7%89%87%E3%80%81TCP%E5%88%86%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/10/%E8%AE%A1%E7%BD%91/IP/IP%E5%88%86%E7%89%87%E3%80%81TCP%E5%88%86%E6%AE%B5/" class="post-title-link" itemprop="url">IPåˆ†ç‰‡ã€TCPåˆ†æ®µ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-10 00:05:02 / ä¿®æ”¹æ—¶é—´ï¼š14:29:22" itemprop="dateCreated datePublished" datetime="2025-08-10T00:05:02+08:00">2025-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%BD%91/" itemprop="url" rel="index"><span itemprop="name">è®¡ç½‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%BD%91/IP/" itemprop="url" rel="index"><span itemprop="name">IP</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>åˆ†ç‰‡åˆ†æ®µçš„æ„ä¹‰</p>
<p><img src="/images/21bce90d555f131971131bc865888d4a.png"></p>
<p>MSSå’ŒMTU</p>
<p><img src="/images/1d52a0e45bd3db13b4dd357559d05d2c.webp"></p>
<p><img src="/images/22d3f994b5e89e59dd79bb7fa6983a7f.webp"></p>
<p>IPåˆ†ç‰‡äº†ï¼ŒTCPä¸ºä»€ä¹ˆè¿˜è¦åˆ†æ®µï¼Ÿ</p>
<p>tcpåˆ†æ®µåæ˜¯ä¸ºäº†åœ¨ä¼ è¾“å±‚ä¿è¯åè®®çš„å¯é æ€§ï¼Œå› æ­¤ç»™æ¯ä¸ªæ®µæ‰“ä¸Šæ ‡è¯†ç¬¦ï¼Œå¯ä»¥å®ç°å¤±è´¥é‡ä¼ å’Œæµé‡æ§åˆ¶</p>
<p>çš„æ“ä½œ</p>
<p>ä¸åˆ†æ®µçš„è¯ï¼Œå¦‚æœè¿™æ—¶å€™æŸä¸ªIPåˆ†ç‰‡ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªIPæŠ¥æ–‡çš„åˆ†ç‰‡å°†é‡ä¼ ã€‚å› ä¸ºæ¥å—æ–¹æ”¶ä¸åˆ°å®Œæ•´æ•°æ®</p>
<p>å°±ä¸ä¼šå›å¤ackï¼Œtcpè¿™è¾¹æ”¶ä¸åˆ°ackï¼Œå°±ä¼šè§¦å‘é‡ä¼ æœºåˆ¶ï¼ŒåŒæ—¶å› ä¸ºä¸çŸ¥é“æ˜¯å“ªä¸ªåˆ†ç‰‡ä¸¢äº†ï¼Œæ‰€ä»¥ä¼šå°†æ•´</p>
<p>ä¸ªIPæŠ¥æ–‡çš„åˆ†ç‰‡é‡ä¼ </p>
<p>:::color4<br>å¦‚æœTCPæŠŠè¿™ä»½æ•°æ®ï¼Œåˆ†æ®µä¸ºNä¸ªå°äºç­‰äºMSSé•¿åº¦çš„æ•°æ®åŒ…ï¼Œåˆ°äº†IPå±‚ååŠ ä¸ŠIPå¤´å’ŒTCPå¤´ï¼Œè¿˜æ˜¯å°äºMTUï¼Œ<font style="background-color:#FBDE28;">é‚£ä¹ˆIPå±‚ä¹Ÿä¸ä¼šå†è¿›è¡Œåˆ†åŒ…</font>ã€‚æ­¤æ—¶åœ¨ä¼ è¾“è·¯ä¸Šå‘ç”Ÿäº†ä¸¢åŒ…ï¼Œé‚£ä¹ˆTCPé‡ä¼ çš„æ—¶å€™ä¹Ÿåªæ˜¯é‡ä¼ é‚£ä¸€å°éƒ¨åˆ†çš„MSSæ®µã€‚æ•ˆç‡ä¼šæ¯”TCPä¸åˆ†æ®µæ—¶æ›´é«˜ã€‚</p>
<p>:::</p>
<p><font style="color:rgb(25, 27, 31);">å³åˆ†æ®µçš„æ„ä¹‰å°±æ˜¯ä¸ºäº†æé«˜é‡ä¼ çš„æ•ˆç‡</font></p>
<p><font style="color:rgb(25, 27, 31);">åŒä¸ºä¼ è¾“å±‚åè®®çš„UDPï¼Œå°±ä¸ä¼šè¿›è¡Œä¸€ä¸ªåˆ†æ®µï¼Œé‡ä¼ æ—¶å°±ç›´æ¥é‡ä¼ ä¸€æ•´æ®µ</font></p>
<p>TCPåˆ†æ®µäº†ï¼ŒIPä¸ºå•¥è¿˜è¦åˆ†ç‰‡å‘¢ï¼Ÿ</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å‘é€ç«¯ï¼Œtcpåˆ†æ®µåï¼ŒIPå°±ä¸ä¼šç»§ç»­åˆ†ç‰‡äº†ã€‚ä½†åœ¨ä¼ è¾“é“¾è·¯è¿‡ç¨‹ä¸­ï¼Œmtuæ˜¯ä¼šå˜åŒ–çš„ï¼ŒIPåˆ†</p>
<p>ç‰‡å°±èµ·åˆ°ä¸€ä¸ªå…œåº•çš„ä½œç”¨ </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/09/%E8%AE%A1%E7%BD%91/IP/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%92%E5%88%86%E7%BD%91%E7%BB%9C%E5%8F%B7%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%8F%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/09/%E8%AE%A1%E7%BD%91/IP/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%92%E5%88%86%E7%BD%91%E7%BB%9C%E5%8F%B7%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%8F%B7/" class="post-title-link" itemprop="url">ä¸ºä»€ä¹ˆè¦åˆ’åˆ†ç½‘ç»œå·å’Œä¸»æœºå·</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-09 23:55:11" itemprop="dateCreated datePublished" datetime="2025-08-09T23:55:11+08:00">2025-08-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-10 00:05:03" itemprop="dateModified" datetime="2025-08-10T00:05:03+08:00">2025-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%BD%91/" itemprop="url" rel="index"><span itemprop="name">è®¡ç½‘</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%BD%91/IP/" itemprop="url" rel="index"><span itemprop="name">IP</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ä¸»æœºå·å’Œç½‘ç»œå·æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ç½‘ç»œå·ç”¨æ¥æ ‡è¯†å¤„äºå“ªä¸ªç½‘ç»œï¼Œè€Œä¸»æœºå·åˆ™ç”¨äºæ ‡è¯†å¤„äºå“ªå°è®¾å¤‡</p>
<p>egï¼š</p>
<p>:::color1<br>192.168.10.25 &#x3D; 11000000.10101000.00001010.00011001</p>
<p>æ ¹æ®å­ç½‘æ©ç çš„ <code>1</code> ä½æ•°ï¼š</p>
<pre><code>- **å‰ 24 ä½**ï¼šç½‘ç»œå·
- **å 8 ä½**ï¼šä¸»æœºå·
</code></pre>
<p>ç½‘ç»œå·ï¼š11000000.10101000.00001010    &#x3D; 192.168.10</p>
<p>ä¸»æœºå·ï¼š00011001                      &#x3D; 25</p>
<p>:::</p>
<p>æ‰€ä»¥ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚æœä¸åŒºåˆ†çš„è¯ï¼Œé‚£ä¹ˆIPåœ°å€å°†ä¸å¤Ÿç”¨ï¼Œå› ä¸ºé‚£å°±æ„å‘³ç€æ¯å°è®¾å¤‡å°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç½‘ç»œã€‚è€Œä¸”åˆ’åˆ†åå¯ä»¥åŒºåˆ†ä¸€ä¸ªä¸ªå­ç½‘ï¼Œæ–¹ä¾¿å­ç½‘å†…çš„è®¡ç®—æœºé€šä¿¡</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/08/09/%E8%AE%A1%E7%BD%91/URI%EF%BC%8CURL%EF%BC%8CURN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/09/%E8%AE%A1%E7%BD%91/URI%EF%BC%8CURL%EF%BC%8CURN/" class="post-title-link" itemprop="url">URIï¼ŒURLï¼ŒURN</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-09 23:45:33 / ä¿®æ”¹æ—¶é—´ï¼š23:46:31" itemprop="dateCreated datePublished" datetime="2025-08-09T23:45:33+08:00">2025-08-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%BD%91/" itemprop="url" rel="index"><span itemprop="name">è®¡ç½‘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/images/85e6e2d972ad8596e955d3a5843f4ddd.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/07/31/JUC/MemorySafeLinkedBlockingQueue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/31/JUC/MemorySafeLinkedBlockingQueue/" class="post-title-link" itemprop="url">MemorySafeLinkedBlockingQueue</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-31 23:29:55" itemprop="dateCreated datePublished" datetime="2025-07-31T23:29:55+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-01 01:06:04" itemprop="dateModified" datetime="2025-08-01T01:06:04+08:00">2025-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JUC/" itemprop="url" rel="index"><span itemprop="name">JUC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/BTVDPHVWjBiq9mj3mvT_Vw">https://mp.weixin.qq.com/s/BTVDPHVWjBiq9mj3mvT_Vw</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.soyorin.online/2025/07/31/%E5%9C%BA%E6%99%AF%E9%A2%98/why%E6%80%BB/jdk%20bug%20%E5%90%88%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/boqi.jpg">
      <meta itemprop="name" content="lkl">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | soyoçš„è·¨æœºæˆ¿éƒ¨ç½²ã€åŒåŸåŒæ´»ã€å¼‚åœ°å¤šæ´»ã€9ä¸ª9é«˜å¯ç”¨åšå®¢yuqueç¬”è®°åŒæ­¥site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/31/%E5%9C%BA%E6%99%AF%E9%A2%98/why%E6%80%BB/jdk%20bug%20%E5%90%88%E9%9B%86/" class="post-title-link" itemprop="url">jdk bug åˆé›†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-31 00:34:59 / ä¿®æ”¹æ—¶é—´ï¼š00:36:57" itemprop="dateCreated datePublished" datetime="2025-07-31T00:34:59+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%BA%E6%99%AF%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">åœºæ™¯é¢˜</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%BA%E6%99%AF%E9%A2%98/why%E6%80%BB/" itemprop="url" rel="index"><span itemprop="name">whyæ€»</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/EncxQEET60FCL0fsWzAt9g">åˆºæ¿€ï¼Œçº¿ç¨‹æ± çš„ä¸€ä¸ªBUGç›´æ¥æŠŠCPUå¹²åˆ°100%äº†ã€‚</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/16/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/18/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">lkl</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/soyobat" class="github-corner" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
